---
title: "Practical Machine Learning"
author: "Emmanuel Fon"
date: "5/24/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r eval=TRUE, echo=TRUE, error=FALSE}
library(caret) 
library(lattice)
library(ggplot2)
library(e1071)
library(randomForest)
library(RANN)
library(klaR)
library(tidyverse)
library(skimr)
```
Load the data into R

```{r eval=TRUE, echo=TRUE}
jawbone <- read.csv(file.choose(), header = TRUE, na.strings= c("NA", "#DIV/0!", ""))#, "#DIV/0!")) # file.choose()  CHOOSE FILE


jawNA <- (colSums(is.na(jawbone)) == 0)

jawclean <- jawbone[ ,jawNA]

jawclean2 <- jawclean[1:6500, -c(1:6) ] # selected only rows 1:1000 for faster processing. Use all rows for full dataset
#view(jawclean2)
```

## TEST SET
This set will not be used as validation but to answer final questions for project.

```{r eval=FALSE}
Testfile <- read.csv(file.choose(), header = TRUE, na.strings = c("NA", "#DIV/0!", ""))
TestNA <- (colSums(is.na(Testfile)) == 0)
Testset <- Testfile[ ,TestNA]

```





## Split the data into training and testing sets.

```{r eval=TRUE, echo=TRUE}
set.seed(100)



jawboneIndex <- createDataPartition(y=jawclean2$classe, p=0.6, list = FALSE) # 60% (0.6) for training and 40% for testing

jawbonetrain <- jawclean2[jawboneIndex, ]
jawbonetest <- jawclean2[-jawboneIndex, ]

y <- jawbonetrain$classe
```







## MISSING DATA: 
We handle missing data using method 'knnImpute'

```{r }
jawbonemissing <- preProcess(jawbonetrain, method = c("knnImpute"))


#juicemissing <- preProcess(juicetrain, method = c("knnImpute"))

#juicemissing
 
jawbonetrain <- predict(jawbonemissing, newdata = jawbonetrain)

anyNA(jawbonetrain)

jawtestmissing <- predict(jawbonemissing, newdata = jawbonetest)
```

## Dummy Variables
We assign dummy variables to transform factor classes to numeric for easy analysis.

```{r }
jawbonedummy <- dummyVars(classe~., data = jawbonetrain)
# juicetrain <- predict(juicemissing, newdata = juicetrain)
## anyNA(juicetrain)
## juicetestmissing <- predict(juicemissing, newdata = juicetest)
jawdumpre <- predict(jawbonedummy, newdata = jawbonetrain)

jawbonetrain <- data.frame(jawdumpre)

jawbonetrain$classe <- y
jawtestdummy <- predict(jawbonedummy, newdata = jawtestmissing)
```

```{r eval=FALSE, echo=FALSE}
# DUMMY VARIABLES

# juicedummy  <- dummyVars(Purchase~., data = juicetrain)
# 
# juicedumpre <- predict(juicedummy, newdata = juicetrain)
# 
# juicetrain <- data.frame(juicedumpre)
# 
# juicetrain$Purchase <- y   #y above
```


## Train the Model

```{r eval=TRUE}
jawModel <- train(classe~., data = jawbonetrain, method = "rf") # random forests

jawModel # view the model
```

Plot the Model and see which variables are most important

```{r }
plot(jawModel, main = "Model Accuracies")

varimport <- varImp(jawModel)

plot(varimport, main = "Variable Importance")
```

```{r echo=FALSE, eval=FALSE}
#juicetestdummy <- predict(juicedummy, newdata = juicetestmissing)

#TRAIN

#juiceModel <- train(Purchase~., data = juicetrain, method = "rf")

# juicefitted <- predict(juiceModel)
#juiceModel

# plot(juiceModel, main = "Model Accuracies with MARS")

## Variable Importance
#Varimport <- varImp(juiceModel)
#plot(Varimport, main = "Variable Importance with MARS")

#juiceModel
## Predict Model Fit
Predict the model on test data and view confusion matrix to determine our accuracy.

```{r }
jawPredict <- predict(jawModel , jawtestdummy)

#check as.factor()
confusionMatrix(data = jawPredict, reference = as.factor(jawbonetest$classe) )
```










## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
